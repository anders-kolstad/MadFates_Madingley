<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 5 Norway - default settings | Running the Madingley Model with Norwegian data</title>
  <meta name="description" content="Chapter 5 Norway - default settings | Running the Madingley Model with Norwegian data" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 5 Norway - default settings | Running the Madingley Model with Norwegian data" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 5 Norway - default settings | Running the Madingley Model with Norwegian data" />
  
  
  

<meta name="author" content="Anders L. Kolstad" />


<meta name="date" content="2022-08-10" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="step-4---spin-up-and-demonstrating-plotting-functions.html"/>
<link rel="next" href="exploring-spatial-inputs.html"/>
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.20/datatables.js"></script>
<link href="libs/dt-core-1.11.3/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.11.3/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.11.3/js/jquery.dataTables.min.js"></script>
<link href="libs/dt-ext-fixedcolumns-1.11.3/css/fixedColumns.dataTables.min.css" rel="stylesheet" />
<script src="libs/dt-ext-fixedcolumns-1.11.3/js/dataTables.fixedColumns.min.js"></script>
<link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet" />
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#some-useful-links"><i class="fa fa-check"></i><b>1.1</b> Some useful links</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="index.html"><a href="index.html#examples-of-use"><i class="fa fa-check"></i><b>1.1.1</b> Examples of use</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#terms-and-definitions"><i class="fa fa-check"></i><b>1.2</b> Terms and definitions</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="installation.html"><a href="installation.html"><i class="fa fa-check"></i><b>2</b> Installation</a></li>
<li class="chapter" data-level="3" data-path="step-1---3.html"><a href="step-1---3.html"><i class="fa fa-check"></i><b>3</b> Step 1 - 3</a>
<ul>
<li class="chapter" data-level="3.1" data-path="step-1---3.html"><a href="step-1---3.html#step-1---load-data"><i class="fa fa-check"></i><b>3.1</b> Step 1 - Load data</a></li>
<li class="chapter" data-level="3.2" data-path="step-1---3.html"><a href="step-1---3.html#step-2---modify-input-parameters"><i class="fa fa-check"></i><b>3.2</b> Step 2 - Modify input parameters</a></li>
<li class="chapter" data-level="3.3" data-path="step-1---3.html"><a href="step-1---3.html#step-3---initialisation"><i class="fa fa-check"></i><b>3.3</b> Step 3 - Initialisation</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="step-4---spin-up-and-demonstrating-plotting-functions.html"><a href="step-4---spin-up-and-demonstrating-plotting-functions.html"><i class="fa fa-check"></i><b>4</b> Step 4 - Spin-up and demonstrating plotting functions</a></li>
<li class="chapter" data-level="5" data-path="norway---default-settings.html"><a href="norway---default-settings.html"><i class="fa fa-check"></i><b>5</b> Norway - default settings</a>
<ul>
<li class="chapter" data-level="5.1" data-path="norway---default-settings.html"><a href="norway---default-settings.html#grid-cells"><i class="fa fa-check"></i><b>5.1</b> 16 grid cells</a></li>
<li class="chapter" data-level="5.2" data-path="norway---default-settings.html"><a href="norway---default-settings.html#single-grid-cell"><i class="fa fa-check"></i><b>5.2</b> Single grid cell</a></li>
<li class="chapter" data-level="5.3" data-path="norway---default-settings.html"><a href="norway---default-settings.html#biomass-densities-rather-than-total-biomass"><i class="fa fa-check"></i><b>5.3</b> Biomass densities rather than total biomass</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="exploring-spatial-inputs.html"><a href="exploring-spatial-inputs.html"><i class="fa fa-check"></i><b>6</b> Exploring spatial inputs</a>
<ul>
<li class="chapter" data-level="6.1" data-path="exploring-spatial-inputs.html"><a href="exploring-spatial-inputs.html#climate-data"><i class="fa fa-check"></i><b>6.1</b> Climate data</a></li>
<li class="chapter" data-level="6.2" data-path="exploring-spatial-inputs.html"><a href="exploring-spatial-inputs.html#other-spatial-inputs"><i class="fa fa-check"></i><b>6.2</b> Other spatial inputs</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="trophic-pyramids.html"><a href="trophic-pyramids.html"><i class="fa fa-check"></i><b>7</b> Trophic pyramids</a>
<ul>
<li class="chapter" data-level="7.1" data-path="trophic-pyramids.html"><a href="trophic-pyramids.html#fixing-a-bug-inthe-r-package"><i class="fa fa-check"></i><b>7.1</b> Fixing a bug inthe R package</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Running the Madingley Model with Norwegian data</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="norway---default-settings" class="section level1" number="5">
<h1><span class="header-section-number">Chapter 5</span> Norway - default settings</h1>
<p>This is just a first look at what the model predicts for Norway with default settings.</p>
<p>This page was last updated <code>2022-08-10 14:56:06</code></p>
<p>First we try with 4 x 4 grid cells (16 grid cells, with dispersion) in south-central Norway. Then we try with just one grid cell, but a longer temporal scope.</p>
<div id="grid-cells" class="section level2" number="5.1">
<h2><span class="header-section-number">5.1</span> 16 grid cells</h2>
<p>Lets start with a too big bonding box for illustration.</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="norway---default-settings.html#cb49-1" aria-hidden="true" tabindex="-1"></a>spatial_window <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">12</span>, <span class="dv">58</span>, <span class="dv">65</span>)</span>
<span id="cb49-2"><a href="norway---default-settings.html#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_spatialwindow</span>(spatial_window)</span></code></pre></div>
<p><img src="04-Norway_default_settings_files/figure-html/unnamed-chunk-1-1.png" width="672" /></p>
<p>The default resolution is 1 degree, giving (7 x 7 =) 49 cells in this case, which is too much for testing purpuses due to compuatation time. The resolution is defined by the spatial input rasters, but 1 degree resolution is the maximum. Finer resolution is possible, ut not courser. I will therefore focus on just Central Norway. Plotting on top of mean annual temperature.</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="norway---default-settings.html#cb50-1" aria-hidden="true" tabindex="-1"></a>mat <span class="ot">=</span> <span class="fu">mean</span>(sptl_inp[[<span class="dv">10</span>]])</span></code></pre></div>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="norway---default-settings.html#cb51-1" aria-hidden="true" tabindex="-1"></a>spatial_window <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">6</span>, <span class="dv">10</span>, <span class="dv">59</span>, <span class="dv">63</span>)</span>
<span id="cb51-2"><a href="norway---default-settings.html#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_spatialwindow</span>(spatial_window, </span>
<span id="cb51-3"><a href="norway---default-settings.html#cb51-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">55</span>,<span class="dv">65</span>), <span class="at">xlim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">10</span>,<span class="dv">20</span>),</span>
<span id="cb51-4"><a href="norway---default-settings.html#cb51-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">input_raster =</span> mat)</span></code></pre></div>
<p><img src="04-Norway_default_settings_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<p>Notice how at high latitudes, one degree north-south is much longer in distance compared to 1 degree east-west.
Run time: approx 5 sec.</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="norway---default-settings.html#cb52-1" aria-hidden="true" tabindex="-1"></a>mdata <span class="ot">&lt;-</span>  <span class="fu">madingley_init</span>(<span class="at">spatial_window =</span> spatial_window,</span>
<span id="cb52-2"><a href="norway---default-settings.html#cb52-2" aria-hidden="true" tabindex="-1"></a>                       <span class="at">cohort_def =</span> chrt_def,</span>
<span id="cb52-3"><a href="norway---default-settings.html#cb52-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">stock_def =</span> stck_def,</span>
<span id="cb52-4"><a href="norway---default-settings.html#cb52-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">spatial_inputs =</span> sptl_inp,</span>
<span id="cb52-5"><a href="norway---default-settings.html#cb52-5" aria-hidden="true" tabindex="-1"></a>                       <span class="at">max_cohort =</span> <span class="dv">100</span>)</span></code></pre></div>
<pre><code>% Processing: realm_classification, land_mask, hanpp, available_water_capacity
% Processing: Ecto_max, Endo_C_max, Endo_H_max, Endo_O_max
% Processing: terrestrial_net_primary_productivity_1-12
% Processing: near-surface_temperature_1-12
% Processing: precipitation_1-12
% Processing: ground_frost_frequency_1-12
% Processing: diurnal_temperature_range_1-12
% </code></pre>
<p>Running the model for 100 years with default setting, exept the max limit og 100 cohorts per grid cell.</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="norway---default-settings.html#cb54-1" aria-hidden="true" tabindex="-1"></a>mdata2 <span class="ot">&lt;-</span>  <span class="fu">madingley_run</span>(</span>
<span id="cb54-2"><a href="norway---default-settings.html#cb54-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">out_dir =</span> <span class="st">&quot;temp&quot;</span>,</span>
<span id="cb54-3"><a href="norway---default-settings.html#cb54-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">madingley_data =</span> mdata, </span>
<span id="cb54-4"><a href="norway---default-settings.html#cb54-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">years =</span> <span class="dv">100</span>, </span>
<span id="cb54-5"><a href="norway---default-settings.html#cb54-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">cohort_def =</span> chrt_def, </span>
<span id="cb54-6"><a href="norway---default-settings.html#cb54-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">stock_def =</span> stck_def, </span>
<span id="cb54-7"><a href="norway---default-settings.html#cb54-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">spatial_inputs =</span> sptl_inp, </span>
<span id="cb54-8"><a href="norway---default-settings.html#cb54-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">model_parameters =</span> mdl_prms,</span>
<span id="cb54-9"><a href="norway---default-settings.html#cb54-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">max_cohort =</span> <span class="dv">100</span>,</span>
<span id="cb54-10"><a href="norway---default-settings.html#cb54-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">silenced =</span> <span class="cn">TRUE</span>)</span>
<span id="cb54-11"><a href="norway---default-settings.html#cb54-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-12"><a href="norway---default-settings.html#cb54-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Runtime approx 15 sec for 10 years and 2 min for 100 years</span></span></code></pre></div>
<p>Save the output.</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="norway---default-settings.html#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(mdata2, chrt_def, mdl_prms, sptl_inp, stck_def, </span>
<span id="cb55-2"><a href="norway---default-settings.html#cb55-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">file =</span> <span class="st">&quot;data/NorwayDefaultSpinup.RData&quot;</span>)</span></code></pre></div>
<p>And read back</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="norway---default-settings.html#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">&quot;data/NorwayDefaultSpinup.RData&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="norway---default-settings.html#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_timelines</span>(mdata2)</span></code></pre></div>
<pre><code>% Warning in xtfrm.data.frame(x): cannot xtfrm data frames

% Warning in xtfrm.data.frame(x): cannot xtfrm data frames</code></pre>
<p><img src="04-Norway_default_settings_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<p>The 100 year spin up was seemingly enough, and we can see the variation stabelising rather quickly. The seasonal patterns are visible for both autotrophs and heterotrophs, but is it big enough?</p>
<p>Interestingly, when I ran this same code in December 2021, albeit for 10 year only, I got plant biomass that was orders of magnitude higher. The model actually predicted biomass about 50% higher than the total terrestrial biomass on the planet. I <a href="https://github.com/MadingleyR/MadingleyR/issues/1">reported this to the developers</a>, and they have now hopefully fixed it.</p>
<p><img src="figures/norwaySpinUPDecember2021.PNG" /></p>
<p>Figure: Snapshot of the result from doing a 10 year spin up for the same spatial window, using defoult setting, in December 2021.</p>
<p>Lets look at the pattern in autotrophic biomass without the log transformation</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="norway---default-settings.html#cb59-1" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> mdata2<span class="sc">$</span>time_line_stocks</span>
<span id="cb59-2"><a href="norway---default-settings.html#cb59-2" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> temp[temp<span class="sc">$</span>Year <span class="sc">&gt;</span><span class="dv">90</span>,] <span class="co"># last 10 years of the simulation</span></span>
<span id="cb59-3"><a href="norway---default-settings.html#cb59-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> temp,</span>
<span id="cb59-4"><a href="norway---default-settings.html#cb59-4" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> Month, </span>
<span id="cb59-5"><a href="norway---default-settings.html#cb59-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> TotalStockBiomass<span class="sc">/</span><span class="dv">10</span><span class="sc">^</span><span class="dv">12</span>))<span class="sc">+</span></span>
<span id="cb59-6"><a href="norway---default-settings.html#cb59-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">lwd =</span> <span class="fl">1.5</span>, <span class="at">colour =</span> <span class="st">&quot;grey&quot;</span>)<span class="sc">+</span></span>
<span id="cb59-7"><a href="norway---default-settings.html#cb59-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span> )<span class="sc">+</span></span>
<span id="cb59-8"><a href="norway---default-settings.html#cb59-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb59-9"><a href="norway---default-settings.html#cb59-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Autrophic biomass (megatons)&quot;</span>)<span class="sc">+</span></span>
<span id="cb59-10"><a href="norway---default-settings.html#cb59-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.25</span>))</span></code></pre></div>
<p><img src="04-Norway_default_settings_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
<p>Actually, this is not unreasonable. Perhaps the biomass even drops too much in winter, seeing how a lot of it should be woody, perennial biomass. Unfortunately I’m not able to extract the biomass for deciduous and coniferous plant separately, except for the last year. This is the mean over the last year I think:</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="norway---default-settings.html#cb60-1" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> mdata2<span class="sc">$</span>stocks</span>
<span id="cb60-2"><a href="norway---default-settings.html#cb60-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-3"><a href="norway---default-settings.html#cb60-3" aria-hidden="true" tabindex="-1"></a><span class="co"># sum across the 16 grid cells</span></span>
<span id="cb60-4"><a href="norway---default-settings.html#cb60-4" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(<span class="at">data =</span> temp,</span>
<span id="cb60-5"><a href="norway---default-settings.html#cb60-5" aria-hidden="true" tabindex="-1"></a>                  TotalBiomass<span class="sc">~</span>FunctionalGroupIndex,</span>
<span id="cb60-6"><a href="norway---default-settings.html#cb60-6" aria-hidden="true" tabindex="-1"></a>                  <span class="at">FUN =</span> sum)</span>
<span id="cb60-7"><a href="norway---default-settings.html#cb60-7" aria-hidden="true" tabindex="-1"></a><span class="co">#rename</span></span>
<span id="cb60-8"><a href="norway---default-settings.html#cb60-8" aria-hidden="true" tabindex="-1"></a>temp<span class="sc">$</span>FunctionalType <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(temp<span class="sc">$</span>FunctionalGroupIndex<span class="sc">==</span><span class="dv">0</span>, <span class="st">&quot;Decidious&quot;</span>, <span class="st">&quot;Evergreen&quot;</span>)</span>
<span id="cb60-9"><a href="norway---default-settings.html#cb60-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-10"><a href="norway---default-settings.html#cb60-10" aria-hidden="true" tabindex="-1"></a><span class="co">#plot</span></span>
<span id="cb60-11"><a href="norway---default-settings.html#cb60-11" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> temp,</span>
<span id="cb60-12"><a href="norway---default-settings.html#cb60-12" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> FunctionalType, </span>
<span id="cb60-13"><a href="norway---default-settings.html#cb60-13" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> TotalBiomass<span class="sc">/</span><span class="dv">10</span><span class="sc">^</span><span class="dv">12</span>))<span class="sc">+</span></span>
<span id="cb60-14"><a href="norway---default-settings.html#cb60-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(</span>
<span id="cb60-15"><a href="norway---default-settings.html#cb60-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>,</span>
<span id="cb60-16"><a href="norway---default-settings.html#cb60-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">&quot;grey&quot;</span>,</span>
<span id="cb60-17"><a href="norway---default-settings.html#cb60-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">colour =</span> <span class="st">&quot;grey20&quot;</span>,</span>
<span id="cb60-18"><a href="norway---default-settings.html#cb60-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">size=</span><span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb60-19"><a href="norway---default-settings.html#cb60-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb60-20"><a href="norway---default-settings.html#cb60-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Autrophic biomass (megatons)&quot;</span>)</span></code></pre></div>
<p><img src="04-Norway_default_settings_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
<p>This ratio makes sense, and could be tested using landsskogtakseringen. But the numbers are really big! There is a mistake here. Perhaps he page developers didn’t update this part of the output?</p>
<p>There should be almost no biomass in winter for ectothermic, semelparous species (e.g. FG3).</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="norway---default-settings.html#cb61-1" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> mdata2<span class="sc">$</span>time_line_cohorts</span>
<span id="cb61-2"><a href="norway---default-settings.html#cb61-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-3"><a href="norway---default-settings.html#cb61-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> temp,</span>
<span id="cb61-4"><a href="norway---default-settings.html#cb61-4" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> Month, </span>
<span id="cb61-5"><a href="norway---default-settings.html#cb61-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> Biomass_FG_3<span class="sc">/</span><span class="dv">10</span><span class="sc">^</span><span class="dv">6</span>),</span>
<span id="cb61-6"><a href="norway---default-settings.html#cb61-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">group =</span> )<span class="sc">+</span></span>
<span id="cb61-7"><a href="norway---default-settings.html#cb61-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">lwd =</span> <span class="dv">1</span>, <span class="at">colour =</span> <span class="st">&quot;black&quot;</span>)<span class="sc">+</span></span>
<span id="cb61-8"><a href="norway---default-settings.html#cb61-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb61-9"><a href="norway---default-settings.html#cb61-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Biomass (tons) for herbivorous,</span><span class="sc">\n</span><span class="st">ectothermic and semelparous species&quot;</span>)</span></code></pre></div>
<p><img src="04-Norway_default_settings_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
<p>The model is very unstabel here for a long time, I we cannot really trust the results. But looking a bit closer a the last 10 years:</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="norway---default-settings.html#cb62-1" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> mdata2<span class="sc">$</span>time_line_cohorts</span>
<span id="cb62-2"><a href="norway---default-settings.html#cb62-2" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> temp[temp<span class="sc">$</span>Year<span class="sc">&gt;</span><span class="dv">90</span>,]</span>
<span id="cb62-3"><a href="norway---default-settings.html#cb62-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-4"><a href="norway---default-settings.html#cb62-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> temp[temp<span class="sc">$</span>Year<span class="sc">&gt;</span><span class="dv">90</span>,],</span>
<span id="cb62-5"><a href="norway---default-settings.html#cb62-5" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> Month, </span>
<span id="cb62-6"><a href="norway---default-settings.html#cb62-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> Biomass_FG_3<span class="sc">/</span><span class="dv">10</span><span class="sc">^</span><span class="dv">6</span>),</span>
<span id="cb62-7"><a href="norway---default-settings.html#cb62-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">group =</span> )<span class="sc">+</span></span>
<span id="cb62-8"><a href="norway---default-settings.html#cb62-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">lwd =</span> <span class="dv">1</span>, <span class="at">colour =</span> <span class="st">&quot;black&quot;</span>)<span class="sc">+</span></span>
<span id="cb62-9"><a href="norway---default-settings.html#cb62-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span> )<span class="sc">+</span></span>
<span id="cb62-10"><a href="norway---default-settings.html#cb62-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb62-11"><a href="norway---default-settings.html#cb62-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Biomass (tons) for herbivorous,</span><span class="sc">\n</span><span class="st">ectothermic and semelparous species&quot;</span>)</span></code></pre></div>
<p><img src="04-Norway_default_settings_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
<p>Here we actually see the biomass getting quite close to zero in winter, as predicted. I winder if we could ever get some data to validate these numbers for insect biomass.</p>
<p>Bird migration I don’t think is accounted for.</p>
<p>Looking at the log transformed data I thought getting the Madingley model to capture the seasonal change would perhaps be the biggest issue, but these last figures are more promising.</p>
<p>What are the most dominant functional groups? This is also quite difficult to read from log transformed figures. Lets explore the total biomass in august of the last year.</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="norway---default-settings.html#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co">#First,let make more intuitive names for the functional groups.</span></span>
<span id="cb63-2"><a href="norway---default-settings.html#cb63-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-3"><a href="norway---default-settings.html#cb63-3" aria-hidden="true" tabindex="-1"></a>link <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb63-4"><a href="norway---default-settings.html#cb63-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">FG =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">8</span>,<span class="dv">1</span>),</span>
<span id="cb63-5"><a href="norway---default-settings.html#cb63-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">FGname =</span> <span class="fu">c</span>(<span class="st">&quot;Endo. herb.&quot;</span>,</span>
<span id="cb63-6"><a href="norway---default-settings.html#cb63-6" aria-hidden="true" tabindex="-1"></a>             <span class="st">&quot;Endo. carn.&quot;</span>,</span>
<span id="cb63-7"><a href="norway---default-settings.html#cb63-7" aria-hidden="true" tabindex="-1"></a>             <span class="st">&quot;Endo. omni.&quot;</span>,</span>
<span id="cb63-8"><a href="norway---default-settings.html#cb63-8" aria-hidden="true" tabindex="-1"></a>             <span class="st">&quot;Ecto. sem. herb.&quot;</span>, <span class="co"># semelparous (insect etc)</span></span>
<span id="cb63-9"><a href="norway---default-settings.html#cb63-9" aria-hidden="true" tabindex="-1"></a>             <span class="st">&quot;Ecto. sem. carn.&quot;</span>,</span>
<span id="cb63-10"><a href="norway---default-settings.html#cb63-10" aria-hidden="true" tabindex="-1"></a>             <span class="st">&quot;Ecto. sem. omni.&quot;</span>,</span>
<span id="cb63-11"><a href="norway---default-settings.html#cb63-11" aria-hidden="true" tabindex="-1"></a>             <span class="st">&quot;Ecto. itero. herb.&quot;</span>, <span class="co"># iteroparous (reptiles etc)</span></span>
<span id="cb63-12"><a href="norway---default-settings.html#cb63-12" aria-hidden="true" tabindex="-1"></a>             <span class="st">&quot;Ecto. itero. carn.&quot;</span>,</span>
<span id="cb63-13"><a href="norway---default-settings.html#cb63-13" aria-hidden="true" tabindex="-1"></a>             <span class="st">&quot;Ecto. itero. omni.&quot;</span></span>
<span id="cb63-14"><a href="norway---default-settings.html#cb63-14" aria-hidden="true" tabindex="-1"></a>             )</span>
<span id="cb63-15"><a href="norway---default-settings.html#cb63-15" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="norway---default-settings.html#cb64-1" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> mdata2<span class="sc">$</span>time_line_cohorts</span>
<span id="cb64-2"><a href="norway---default-settings.html#cb64-2" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> temp[temp<span class="sc">$</span>Month <span class="sc">==</span> <span class="fu">max</span>(temp<span class="sc">$</span>Month)<span class="sc">-</span><span class="dv">4</span>,]</span>
<span id="cb64-3"><a href="norway---default-settings.html#cb64-3" aria-hidden="true" tabindex="-1"></a>data.table<span class="sc">::</span><span class="fu">setDT</span>(temp)</span>
<span id="cb64-4"><a href="norway---default-settings.html#cb64-4" aria-hidden="true" tabindex="-1"></a>tempM <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">melt</span>(temp[,<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)])</span></code></pre></div>
<pre><code>% Warning in melt.data.table(temp[, -c(1:2)]): id.vars and measure.vars are
% internally guessed when both are &#39;NULL&#39;. All non-numeric/integer/logical type
% columns are considered id.vars, which in this case are columns []. Consider
% providing at least one of &#39;id&#39; or &#39;measure&#39; vars in future.</code></pre>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="norway---default-settings.html#cb66-1" aria-hidden="true" tabindex="-1"></a>tempM<span class="sc">$</span>FG <span class="ot">&lt;-</span> link<span class="sc">$</span>FGname</span>
<span id="cb66-2"><a href="norway---default-settings.html#cb66-2" aria-hidden="true" tabindex="-1"></a>tempM<span class="sc">$</span>tons <span class="ot">&lt;-</span> tempM<span class="sc">$</span>value<span class="sc">/</span><span class="dv">10</span><span class="sc">^</span><span class="dv">6</span></span>
<span id="cb66-3"><a href="norway---default-settings.html#cb66-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-4"><a href="norway---default-settings.html#cb66-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> tempM,</span>
<span id="cb66-5"><a href="norway---default-settings.html#cb66-5" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> FG,</span>
<span id="cb66-6"><a href="norway---default-settings.html#cb66-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> tons))<span class="sc">+</span></span>
<span id="cb66-7"><a href="norway---default-settings.html#cb66-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>,</span>
<span id="cb66-8"><a href="norway---default-settings.html#cb66-8" aria-hidden="true" tabindex="-1"></a>           <span class="at">fill =</span> <span class="st">&quot;grey&quot;</span>,</span>
<span id="cb66-9"><a href="norway---default-settings.html#cb66-9" aria-hidden="true" tabindex="-1"></a>           <span class="at">colour =</span> <span class="st">&quot;grey30&quot;</span>)<span class="sc">+</span></span>
<span id="cb66-10"><a href="norway---default-settings.html#cb66-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>()<span class="sc">+</span></span>
<span id="cb66-11"><a href="norway---default-settings.html#cb66-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="04-Norway_default_settings_files/figure-html/unnamed-chunk-14-1.png" width="672" /></p>
<p>What are the endothermic omnivores in Norway. Mice and things? And bears?
The model predicts very little endothermic carnivore biomass, and quite a bit of ectothermic iteroparous carnivore biomass (snakes?!)</p>
<p>We can look at the relationship between individual size (mean per grid cell) and abundance for herbivorous endotherms</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="norway---default-settings.html#cb67-1" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> mdata2<span class="sc">$</span>cohorts</span>
<span id="cb67-2"><a href="norway---default-settings.html#cb67-2" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> temp[temp<span class="sc">$</span>FunctionalGroupIndex<span class="sc">==</span><span class="dv">0</span>,]</span>
<span id="cb67-3"><a href="norway---default-settings.html#cb67-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-4"><a href="norway---default-settings.html#cb67-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> temp)<span class="sc">+</span></span>
<span id="cb67-5"><a href="norway---default-settings.html#cb67-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">log</span>(IndividualBodyMass), </span>
<span id="cb67-6"><a href="norway---default-settings.html#cb67-6" aria-hidden="true" tabindex="-1"></a>                 <span class="at">y =</span>  <span class="fu">log</span>(CohortAbundance)</span>
<span id="cb67-7"><a href="norway---default-settings.html#cb67-7" aria-hidden="true" tabindex="-1"></a>                 ),</span>
<span id="cb67-8"><a href="norway---default-settings.html#cb67-8" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha=</span>.<span class="dv">1</span>, </span>
<span id="cb67-9"><a href="norway---default-settings.html#cb67-9" aria-hidden="true" tabindex="-1"></a>             <span class="at">size=</span><span class="dv">8</span>, </span>
<span id="cb67-10"><a href="norway---default-settings.html#cb67-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">colour=</span><span class="st">&quot;blue&quot;</span>,</span>
<span id="cb67-11"><a href="norway---default-settings.html#cb67-11" aria-hidden="true" tabindex="-1"></a>             <span class="at">pch=</span><span class="dv">16</span>)<span class="sc">+</span></span>
<span id="cb67-12"><a href="norway---default-settings.html#cb67-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">20</span>)</span></code></pre></div>
<p><img src="04-Norway_default_settings_files/figure-html/unnamed-chunk-15-1.png" width="480" /></p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="norway---default-settings.html#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plotting all grid cells and all cohorts or FG 0</span></span></code></pre></div>
<p>No strong pattern. This is perhaps not very useful, but simply illustrates the two factors that determine the cohort biomass.</p>
<p>Let’s explore the cohort data set (<code>mdata2$cohorts</code>) a bit more.</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="norway---default-settings.html#cb69-1" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> mdata2<span class="sc">$</span>cohorts</span>
<span id="cb69-2"><a href="norway---default-settings.html#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(temp)</span></code></pre></div>
<pre><code>%  GridcellIndex    FunctionalGroupIndex  JuvenileMass         AdultMass       
%  Min.   : 0.000   Min.   :0.000        Min.   :    0.154   Min.   :     2.3  
%  1st Qu.: 4.000   1st Qu.:2.000        1st Qu.:    7.490   1st Qu.:   255.4  
%  Median : 7.000   Median :6.000        Median :   35.138   Median :  1164.1  
%  Mean   : 7.503   Mean   :4.713        Mean   :  437.553   Mean   : 13279.2  
%  3rd Qu.:11.000   3rd Qu.:7.000        3rd Qu.:  190.477   3rd Qu.:  8183.1  
%  Max.   :15.000   Max.   :8.000        Max.   :21664.900   Max.   :343190.0  
%  IndividualBodyMass CohortAbundance     LogOptimalPreyBodySizeRatio
%  Min.   :     0.2   Min.   :1.000e+00   Min.   :-2.716510          
%  1st Qu.:    65.4   1st Qu.:8.348e+03   1st Qu.:-2.462430          
%  Median :   406.2   Median :2.327e+05   Median :-2.344680          
%  Mean   :  7630.8   Mean   :1.514e+08   Mean   :-2.340085          
%  3rd Qu.:  2758.2   3rd Qu.:3.732e+06   3rd Qu.:-2.207560          
%  Max.   :341799.0   Max.   :1.648e+11   Max.   : 0.006092          
%  BirthTimeStep  ProportionTimeActive  TrophicIndex  
%  Min.   :1061   Min.   :0.0000       Min.   :2.000  
%  1st Qu.:1171   1st Qu.:0.0000       1st Qu.:2.000  
%  Median :1193   Median :0.0000       Median :2.025  
%  Mean   :1181   Mean   :0.1647       Mean   :2.411  
%  3rd Qu.:1194   3rd Qu.:0.5000       3rd Qu.:3.000  
%  Max.   :1195   Max.   :0.5000       Max.   :3.971  
%  IndividualReproductivePotentialMass MaturityTimeStep       IsAdult      
%  Min.   :     0.00                   Min.   :1.115e+03   Min.   :0.0000  
%  1st Qu.:     0.00                   1st Qu.:1.193e+03   1st Qu.:0.0000  
%  Median :     0.00                   Median :4.295e+09   Median :0.0000  
%  Mean   :  3818.88                   Mean   :2.692e+09   Mean   :0.3733  
%  3rd Qu.:    37.89                   3rd Qu.:4.295e+09   3rd Qu.:1.0000  
%  Max.   :280520.00                   Max.   :4.295e+09   Max.   :1.0000  
%    AgeMonths      TimeStepsJuviline TimeStepsAdult  
%  Min.   :  4.00   Min.   : 3.00     Min.   : 0.000  
%  1st Qu.:  5.00   1st Qu.: 5.00     1st Qu.: 0.000  
%  Median :  6.00   Median : 6.00     Median : 0.000  
%  Mean   : 18.28   Mean   :11.74     Mean   : 6.545  
%  3rd Qu.: 28.00   3rd Qu.:16.00     3rd Qu.: 6.000  
%  Max.   :138.00   Max.   :77.00     Max.   :84.000</code></pre>
<p>There are 16 cell, and 100 cohorts (row) per cell (because I set 100 as the limit). There are 9 functional groups. Some functional groups have many cohorts per cell.</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="norway---default-settings.html#cb71-1" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> mdata2<span class="sc">$</span>cohorts[mdata2<span class="sc">$</span>cohorts<span class="sc">$</span>GridcellIndex<span class="sc">==</span><span class="dv">0</span>,]</span>
<span id="cb71-2"><a href="norway---default-settings.html#cb71-2" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">table</span>(temp<span class="sc">$</span>FunctionalGroupIndex))</span>
<span id="cb71-3"><a href="norway---default-settings.html#cb71-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-4"><a href="norway---default-settings.html#cb71-4" aria-hidden="true" tabindex="-1"></a>temp2 <span class="ot">&lt;-</span> mdata2<span class="sc">$</span>cohorts[mdata2<span class="sc">$</span>cohorts<span class="sc">$</span>GridcellIndex<span class="sc">==</span><span class="dv">5</span>,]</span>
<span id="cb71-5"><a href="norway---default-settings.html#cb71-5" aria-hidden="true" tabindex="-1"></a>temp2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">table</span>(temp2<span class="sc">$</span>FunctionalGroupIndex))</span>
<span id="cb71-6"><a href="norway---default-settings.html#cb71-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-7"><a href="norway---default-settings.html#cb71-7" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(temp2)[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="st">&quot;FG&quot;</span></span>
<span id="cb71-8"><a href="norway---default-settings.html#cb71-8" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(temp)[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="st">&quot;FG&quot;</span></span>
<span id="cb71-9"><a href="norway---default-settings.html#cb71-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-10"><a href="norway---default-settings.html#cb71-10" aria-hidden="true" tabindex="-1"></a>temp2<span class="sc">$</span>Freq2 <span class="ot">&lt;-</span> temp<span class="sc">$</span>Freq[<span class="fu">match</span>(temp2<span class="sc">$</span>FG, temp<span class="sc">$</span>FG)]</span>
<span id="cb71-11"><a href="norway---default-settings.html#cb71-11" aria-hidden="true" tabindex="-1"></a>data.table<span class="sc">::</span><span class="fu">setDT</span>(temp2)</span>
<span id="cb71-12"><a href="norway---default-settings.html#cb71-12" aria-hidden="true" tabindex="-1"></a>temp3 <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">melt</span>(temp2,</span>
<span id="cb71-13"><a href="norway---default-settings.html#cb71-13" aria-hidden="true" tabindex="-1"></a>                          <span class="at">id.vars =</span> <span class="st">&quot;FG&quot;</span>,</span>
<span id="cb71-14"><a href="norway---default-settings.html#cb71-14" aria-hidden="true" tabindex="-1"></a>                          <span class="at">variable.name =</span> <span class="st">&quot;grid_cell&quot;</span>,</span>
<span id="cb71-15"><a href="norway---default-settings.html#cb71-15" aria-hidden="true" tabindex="-1"></a>                          <span class="at">value.name =</span> <span class="st">&quot;cohorts&quot;</span>)      </span>
<span id="cb71-16"><a href="norway---default-settings.html#cb71-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-17"><a href="norway---default-settings.html#cb71-17" aria-hidden="true" tabindex="-1"></a>temp3<span class="sc">$</span>cohorts[<span class="fu">is.na</span>(temp3<span class="sc">$</span>cohorts)]  <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb71-18"><a href="norway---default-settings.html#cb71-18" aria-hidden="true" tabindex="-1"></a>temp3<span class="sc">$</span>cohorts2 <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(temp3<span class="sc">$</span>cohorts)</span>
<span id="cb71-19"><a href="norway---default-settings.html#cb71-19" aria-hidden="true" tabindex="-1"></a>temp3<span class="sc">$</span>functional_group <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(temp3<span class="sc">$</span>FG)</span>
<span id="cb71-20"><a href="norway---default-settings.html#cb71-20" aria-hidden="true" tabindex="-1"></a>temp3<span class="sc">$</span>grid_cell <span class="ot">&lt;-</span> <span class="fu">as.character</span>(temp3<span class="sc">$</span>grid_cell)</span>
<span id="cb71-21"><a href="norway---default-settings.html#cb71-21" aria-hidden="true" tabindex="-1"></a>temp3<span class="sc">$</span>grid_cell[temp3<span class="sc">$</span>grid_cell <span class="sc">==</span> <span class="st">&quot;Freq&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;zero&quot;</span></span>
<span id="cb71-22"><a href="norway---default-settings.html#cb71-22" aria-hidden="true" tabindex="-1"></a>temp3<span class="sc">$</span>grid_cell[temp3<span class="sc">$</span>grid_cell <span class="sc">==</span> <span class="st">&quot;Freq2&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;five&quot;</span></span>
<span id="cb71-23"><a href="norway---default-settings.html#cb71-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-24"><a href="norway---default-settings.html#cb71-24" aria-hidden="true" tabindex="-1"></a>temp3<span class="sc">$</span>names <span class="ot">&lt;-</span> link<span class="sc">$</span>FGname[<span class="fu">match</span>(temp3<span class="sc">$</span>FG, link<span class="sc">$</span>FG)]</span>
<span id="cb71-25"><a href="norway---default-settings.html#cb71-25" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> temp3,</span>
<span id="cb71-26"><a href="norway---default-settings.html#cb71-26" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> names,</span>
<span id="cb71-27"><a href="norway---default-settings.html#cb71-27" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> cohorts,</span>
<span id="cb71-28"><a href="norway---default-settings.html#cb71-28" aria-hidden="true" tabindex="-1"></a>           <span class="at">group =</span> grid_cell,</span>
<span id="cb71-29"><a href="norway---default-settings.html#cb71-29" aria-hidden="true" tabindex="-1"></a>           <span class="at">fill =</span> grid_cell</span>
<span id="cb71-30"><a href="norway---default-settings.html#cb71-30" aria-hidden="true" tabindex="-1"></a>           ))<span class="sc">+</span></span>
<span id="cb71-31"><a href="norway---default-settings.html#cb71-31" aria-hidden="true" tabindex="-1"></a>       <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>,</span>
<span id="cb71-32"><a href="norway---default-settings.html#cb71-32" aria-hidden="true" tabindex="-1"></a>                <span class="at">position =</span> <span class="st">&quot;dodge&quot;</span>,</span>
<span id="cb71-33"><a href="norway---default-settings.html#cb71-33" aria-hidden="true" tabindex="-1"></a>                <span class="at">colour=</span><span class="st">&quot;black&quot;</span>)<span class="sc">+</span></span>
<span id="cb71-34"><a href="norway---default-settings.html#cb71-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>()<span class="sc">+</span></span>
<span id="cb71-35"><a href="norway---default-settings.html#cb71-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Number of cohorts&quot;</span>)<span class="sc">+</span></span>
<span id="cb71-36"><a href="norway---default-settings.html#cb71-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;&quot;</span>)<span class="sc">+</span></span>
<span id="cb71-37"><a href="norway---default-settings.html#cb71-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette=</span><span class="st">&quot;Spectral&quot;</span>)</span></code></pre></div>
<p><img src="04-Norway_default_settings_files/figure-html/unnamed-chunk-17-1.png" width="672" /></p>
<p>As we can see, endothermic herbivores (e.g. moose) have the most cohorts in these two cells. They also have the biggest biomass besides plants, as we have seen previously. Endothermic carnivores is not very abundant.</p>
<p>But what separates the endothermic herbivore cohorts?</p>
<p>Lets look some more at differences between the functional groups. A high cohort abundance means you have a high number of similar individuals (e.g. similar in age and size).</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="norway---default-settings.html#cb72-1" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> mdata2<span class="sc">$</span>cohorts</span>
<span id="cb72-2"><a href="norway---default-settings.html#cb72-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-3"><a href="norway---default-settings.html#cb72-3" aria-hidden="true" tabindex="-1"></a>temp2 <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(<span class="at">data =</span> temp,</span>
<span id="cb72-4"><a href="norway---default-settings.html#cb72-4" aria-hidden="true" tabindex="-1"></a>                   IndividualBodyMass<span class="sc">~</span><span class="fu">factor</span>(FunctionalGroupIndex),</span>
<span id="cb72-5"><a href="norway---default-settings.html#cb72-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">FUN =</span> mean)</span>
<span id="cb72-6"><a href="norway---default-settings.html#cb72-6" aria-hidden="true" tabindex="-1"></a>temp2<span class="sc">$</span>CohortAbundance <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(<span class="at">data =</span> temp,</span>
<span id="cb72-7"><a href="norway---default-settings.html#cb72-7" aria-hidden="true" tabindex="-1"></a>                   CohortAbundance<span class="sc">~</span><span class="fu">factor</span>(FunctionalGroupIndex),</span>
<span id="cb72-8"><a href="norway---default-settings.html#cb72-8" aria-hidden="true" tabindex="-1"></a>                   <span class="at">FUN =</span> mean)[,<span class="dv">2</span>]</span>
<span id="cb72-9"><a href="norway---default-settings.html#cb72-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-10"><a href="norway---default-settings.html#cb72-10" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(temp2)[<span class="dv">1</span>]<span class="ot">&lt;-</span> <span class="st">&quot;FG&quot;</span></span>
<span id="cb72-11"><a href="norway---default-settings.html#cb72-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-12"><a href="norway---default-settings.html#cb72-12" aria-hidden="true" tabindex="-1"></a>temp2<span class="sc">$</span>FG <span class="ot">&lt;-</span> <span class="fu">as.character</span>(temp2<span class="sc">$</span>FG)</span>
<span id="cb72-13"><a href="norway---default-settings.html#cb72-13" aria-hidden="true" tabindex="-1"></a>temp2<span class="sc">$</span>FGname <span class="ot">&lt;-</span> link<span class="sc">$</span>FGname[<span class="fu">match</span>(temp2<span class="sc">$</span>FG, link<span class="sc">$</span>FG)]</span>
<span id="cb72-14"><a href="norway---default-settings.html#cb72-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-15"><a href="norway---default-settings.html#cb72-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-16"><a href="norway---default-settings.html#cb72-16" aria-hidden="true" tabindex="-1"></a><span class="co">#ggplot(temp2, aes(x = CohortAbundance,</span></span>
<span id="cb72-17"><a href="norway---default-settings.html#cb72-17" aria-hidden="true" tabindex="-1"></a><span class="co">#                 y = IndividualBodyMass,</span></span>
<span id="cb72-18"><a href="norway---default-settings.html#cb72-18" aria-hidden="true" tabindex="-1"></a><span class="co">#                 label = FGname))+</span></span>
<span id="cb72-19"><a href="norway---default-settings.html#cb72-19" aria-hidden="true" tabindex="-1"></a><span class="co">#  geom_text(size = 5, position =  position_dodge2v(2000))+</span></span>
<span id="cb72-20"><a href="norway---default-settings.html#cb72-20" aria-hidden="true" tabindex="-1"></a><span class="co">#  theme_bw(base_size = 20)+</span></span>
<span id="cb72-21"><a href="norway---default-settings.html#cb72-21" aria-hidden="true" tabindex="-1"></a><span class="co">#  scale_y_continuous(expand = expansion(mult=c(.2,.2)))+</span></span>
<span id="cb72-22"><a href="norway---default-settings.html#cb72-22" aria-hidden="true" tabindex="-1"></a><span class="co">#  scale_x_continuous(expand = expansion(mult=c(.2,.2)))</span></span>
<span id="cb72-23"><a href="norway---default-settings.html#cb72-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-24"><a href="norway---default-settings.html#cb72-24" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> temp2,</span>
<span id="cb72-25"><a href="norway---default-settings.html#cb72-25" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> FGname,</span>
<span id="cb72-26"><a href="norway---default-settings.html#cb72-26" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> CohortAbundance))<span class="sc">+</span></span>
<span id="cb72-27"><a href="norway---default-settings.html#cb72-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>,</span>
<span id="cb72-28"><a href="norway---default-settings.html#cb72-28" aria-hidden="true" tabindex="-1"></a>           <span class="at">fill =</span> <span class="st">&quot;grey&quot;</span>,</span>
<span id="cb72-29"><a href="norway---default-settings.html#cb72-29" aria-hidden="true" tabindex="-1"></a>           <span class="at">colour =</span> <span class="st">&quot;grey30&quot;</span>)<span class="sc">+</span></span>
<span id="cb72-30"><a href="norway---default-settings.html#cb72-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>()<span class="sc">+</span></span>
<span id="cb72-31"><a href="norway---default-settings.html#cb72-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb72-32"><a href="norway---default-settings.html#cb72-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Avg. #individuals per cohort&quot;</span>)</span></code></pre></div>
<p><img src="04-Norway_default_settings_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>
<p>Ectothermic semelparous herbivores (insects) really stick out as being numerous and similar. Note that other functional groups may be more numerous than what this figure shows, because they are split over more cohorts.</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="norway---default-settings.html#cb73-1" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> mdata2<span class="sc">$</span>cohorts</span>
<span id="cb73-2"><a href="norway---default-settings.html#cb73-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-3"><a href="norway---default-settings.html#cb73-3" aria-hidden="true" tabindex="-1"></a>temp2 <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(<span class="at">data =</span> temp,</span>
<span id="cb73-4"><a href="norway---default-settings.html#cb73-4" aria-hidden="true" tabindex="-1"></a>                   CohortAbundance<span class="sc">~</span><span class="fu">factor</span>(FunctionalGroupIndex),</span>
<span id="cb73-5"><a href="norway---default-settings.html#cb73-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">FUN =</span> sum)</span>
<span id="cb73-6"><a href="norway---default-settings.html#cb73-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-7"><a href="norway---default-settings.html#cb73-7" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(temp2)[<span class="dv">1</span>]<span class="ot">&lt;-</span> <span class="st">&quot;FG&quot;</span></span>
<span id="cb73-8"><a href="norway---default-settings.html#cb73-8" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(temp2)[<span class="dv">2</span>]<span class="ot">&lt;-</span> <span class="st">&quot;CohortSum&quot;</span></span>
<span id="cb73-9"><a href="norway---default-settings.html#cb73-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-10"><a href="norway---default-settings.html#cb73-10" aria-hidden="true" tabindex="-1"></a>temp2<span class="sc">$</span>FG <span class="ot">&lt;-</span> <span class="fu">as.character</span>(temp2<span class="sc">$</span>FG)</span>
<span id="cb73-11"><a href="norway---default-settings.html#cb73-11" aria-hidden="true" tabindex="-1"></a>temp2<span class="sc">$</span>FGname <span class="ot">&lt;-</span> link<span class="sc">$</span>FGname[<span class="fu">match</span>(temp2<span class="sc">$</span>FG, link<span class="sc">$</span>FG)]</span>
<span id="cb73-12"><a href="norway---default-settings.html#cb73-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-13"><a href="norway---default-settings.html#cb73-13" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> temp2,</span>
<span id="cb73-14"><a href="norway---default-settings.html#cb73-14" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> FGname,</span>
<span id="cb73-15"><a href="norway---default-settings.html#cb73-15" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> CohortSum))<span class="sc">+</span></span>
<span id="cb73-16"><a href="norway---default-settings.html#cb73-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>,</span>
<span id="cb73-17"><a href="norway---default-settings.html#cb73-17" aria-hidden="true" tabindex="-1"></a>           <span class="at">fill =</span> <span class="st">&quot;grey&quot;</span>,</span>
<span id="cb73-18"><a href="norway---default-settings.html#cb73-18" aria-hidden="true" tabindex="-1"></a>           <span class="at">colour =</span> <span class="st">&quot;grey30&quot;</span>)<span class="sc">+</span></span>
<span id="cb73-19"><a href="norway---default-settings.html#cb73-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>()<span class="sc">+</span></span>
<span id="cb73-20"><a href="norway---default-settings.html#cb73-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb73-21"><a href="norway---default-settings.html#cb73-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Total number of individuals&quot;</span>)</span></code></pre></div>
<p><img src="04-Norway_default_settings_files/figure-html/unnamed-chunk-19-1.png" width="672" /></p>
<p>The patter is the same for total number of individuals.</p>
<p>Now we can look at the cohort biomass distribution for each of the functional groups using this built in function.</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="norway---default-settings.html#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_densities</span>(mdata2)</span></code></pre></div>
<pre><code>% loading inputs from: temp/madingley_outs_09_08_22_13_49_03/</code></pre>
<p><img src="04-Norway_default_settings_files/figure-html/unnamed-chunk-20-1.png" width="672" /></p>
<p>This figure is showing the distribution of total cohort biomass for each FG. For Herbivores (top left), the distribution is left-skewed, telling us that there is a threshold for how big a cohort can get. This can be due to reproductive limitations or perhaps intraspecific competition leading to starvation or dispersal. Ectotherm biomass has a clear optimum, but no limitation in size, probably due to high plasticity in reproductive rates.</p>
<p>And here, the trophic pyramid:</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="norway---default-settings.html#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_trophicpyramid</span>(mdata2)</span></code></pre></div>
<pre><code>% loading inputs from: temp/madingley_outs_09_08_22_13_49_03/</code></pre>
<p><img src="04-Norway_default_settings_files/figure-html/unnamed-chunk-21-1.png" width="672" /></p>
<p>Se the page on trophic pyramids for a more detailed exploration of this figure and what it contains.</p>
<p>Create log10-binned food-web plot</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="norway---default-settings.html#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_foodweb</span>(mdata2, <span class="at">max_flows =</span> <span class="dv">5</span>)</span></code></pre></div>
<pre><code>% loading inputs from: temp/madingley_outs_09_08_22_13_49_03/</code></pre>
<p><img src="04-Norway_default_settings_files/figure-html/unnamed-chunk-22-1.png" width="672" /></p>
<p>The interactions are dominated by endothermic omnivores (mice?) eating endothermic herbivores.
I’m not sure if this is interactions summed over one year, or what.</p>
<p>Plot the spatial biomass</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="norway---default-settings.html#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_spatialbiomass</span>(mdata2, <span class="at">functional_filter =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>% loading inputs from: temp/madingley_outs_09_08_22_13_49_03/</code></pre>
<p><img src="04-Norway_default_settings_files/figure-html/unnamed-chunk-23-1.png" width="672" /></p>
<p>There are strong spatial patterns. FG1 for example, endothermic carnivores, are just about absent in many grid cells.</p>
<p>The next step I think is to go though the model parameters in mdl_prms and see if the settings make sense for boreal, mainly forested or alpine, ecosystem. We can also change values in the spatial input sptl_inp, for example setting the max biomass for ectotherms (we don’t have large reptiles here).</p>
</div>
<div id="single-grid-cell" class="section level2" number="5.2">
<h2><span class="header-section-number">5.2</span> Single grid cell</h2>
<p>Using a single grid cell we can run the simulation for longer, and see how that affects things.</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="norway---default-settings.html#cb82-1" aria-hidden="true" tabindex="-1"></a>spatial_window <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">9</span>, <span class="dv">10</span>, <span class="dv">60</span>, <span class="dv">61</span>)</span>
<span id="cb82-2"><a href="norway---default-settings.html#cb82-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_spatialwindow</span>(spatial_window, </span>
<span id="cb82-3"><a href="norway---default-settings.html#cb82-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">55</span>,<span class="dv">65</span>), <span class="at">xlim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">10</span>,<span class="dv">20</span>),</span>
<span id="cb82-4"><a href="norway---default-settings.html#cb82-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">input_raster =</span> mat)</span></code></pre></div>
<p><img src="04-Norway_default_settings_files/figure-html/unnamed-chunk-24-1.png" width="672" /></p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="norway---default-settings.html#cb83-1" aria-hidden="true" tabindex="-1"></a>mdata <span class="ot">&lt;-</span>  <span class="fu">madingley_init</span>(<span class="at">spatial_window =</span> spatial_window,</span>
<span id="cb83-2"><a href="norway---default-settings.html#cb83-2" aria-hidden="true" tabindex="-1"></a>                       <span class="at">cohort_def =</span> chrt_def,</span>
<span id="cb83-3"><a href="norway---default-settings.html#cb83-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">stock_def =</span> stck_def,</span>
<span id="cb83-4"><a href="norway---default-settings.html#cb83-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">spatial_inputs =</span> sptl_inp,</span>
<span id="cb83-5"><a href="norway---default-settings.html#cb83-5" aria-hidden="true" tabindex="-1"></a>                       <span class="at">max_cohort =</span> <span class="dv">100</span>)</span></code></pre></div>
<pre><code>% Processing: realm_classification, land_mask, hanpp, available_water_capacity
% Processing: Ecto_max, Endo_C_max, Endo_H_max, Endo_O_max
% Processing: terrestrial_net_primary_productivity_1-12
% Processing: near-surface_temperature_1-12
% Processing: precipitation_1-12
% Processing: ground_frost_frequency_1-12
% Processing: diurnal_temperature_range_1-12
% </code></pre>
<p>Using 200 years instead of 100</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="norway---default-settings.html#cb85-1" aria-hidden="true" tabindex="-1"></a>mdata2 <span class="ot">&lt;-</span>  <span class="fu">madingley_run</span>(</span>
<span id="cb85-2"><a href="norway---default-settings.html#cb85-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">out_dir =</span> <span class="st">&quot;temp&quot;</span>,</span>
<span id="cb85-3"><a href="norway---default-settings.html#cb85-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">madingley_data =</span> mdata, </span>
<span id="cb85-4"><a href="norway---default-settings.html#cb85-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">years =</span> <span class="dv">200</span>, </span>
<span id="cb85-5"><a href="norway---default-settings.html#cb85-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">cohort_def =</span> chrt_def, </span>
<span id="cb85-6"><a href="norway---default-settings.html#cb85-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">stock_def =</span> stck_def, </span>
<span id="cb85-7"><a href="norway---default-settings.html#cb85-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">spatial_inputs =</span> sptl_inp, </span>
<span id="cb85-8"><a href="norway---default-settings.html#cb85-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">model_parameters =</span> mdl_prms,</span>
<span id="cb85-9"><a href="norway---default-settings.html#cb85-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">max_cohort =</span> <span class="dv">100</span>,</span>
<span id="cb85-10"><a href="norway---default-settings.html#cb85-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">silenced =</span> <span class="cn">TRUE</span>)</span>
<span id="cb85-11"><a href="norway---default-settings.html#cb85-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-12"><a href="norway---default-settings.html#cb85-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Runtime approx 2-3 min</span></span></code></pre></div>
<p>Save the output.</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="norway---default-settings.html#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(mdata2, <span class="co">#, chrt_def, mdl_prms, sptl_inp, stck_def, </span></span>
<span id="cb86-2"><a href="norway---default-settings.html#cb86-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">file =</span> <span class="st">&quot;data/NorwayDefaultSpinup_1cell.RData&quot;</span>)</span></code></pre></div>
<p>And read back</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="norway---default-settings.html#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">&quot;data/NorwayDefaultSpinup_1cell.RData&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="norway---default-settings.html#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_timelines</span>(mdata2)</span></code></pre></div>
<pre><code>% Warning in xtfrm.data.frame(x): cannot xtfrm data frames

% Warning in xtfrm.data.frame(x): cannot xtfrm data frames</code></pre>
<p><img src="04-Norway_default_settings_files/figure-html/unnamed-chunk-29-1.png" width="672" /></p>
<p>Looks messy.</p>
<p>Plant biomass years 190-200</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="norway---default-settings.html#cb90-1" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> mdata2<span class="sc">$</span>time_line_stocks</span>
<span id="cb90-2"><a href="norway---default-settings.html#cb90-2" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> temp[temp<span class="sc">$</span>Year <span class="sc">&gt;</span><span class="dv">190</span>,] <span class="co"># last 10 years of the simulation</span></span>
<span id="cb90-3"><a href="norway---default-settings.html#cb90-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> temp,</span>
<span id="cb90-4"><a href="norway---default-settings.html#cb90-4" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> Month, </span>
<span id="cb90-5"><a href="norway---default-settings.html#cb90-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> TotalStockBiomass<span class="sc">/</span><span class="dv">10</span><span class="sc">^</span><span class="dv">12</span>))<span class="sc">+</span></span>
<span id="cb90-6"><a href="norway---default-settings.html#cb90-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">lwd =</span> <span class="fl">1.5</span>, <span class="at">colour =</span> <span class="st">&quot;grey&quot;</span>)<span class="sc">+</span></span>
<span id="cb90-7"><a href="norway---default-settings.html#cb90-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span> )<span class="sc">+</span></span>
<span id="cb90-8"><a href="norway---default-settings.html#cb90-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb90-9"><a href="norway---default-settings.html#cb90-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Autrophic biomass (megatons)&quot;</span>)<span class="sc">+</span></span>
<span id="cb90-10"><a href="norway---default-settings.html#cb90-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.025</span>))</span></code></pre></div>
<p><img src="04-Norway_default_settings_files/figure-html/unnamed-chunk-30-1.png" width="672" /></p>
<p>Pattern is the same as before, but the values are a lot lower!</p>
<p>Insect herbivores years 190-200:</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="norway---default-settings.html#cb91-1" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> mdata2<span class="sc">$</span>time_line_cohorts</span>
<span id="cb91-2"><a href="norway---default-settings.html#cb91-2" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> temp[temp<span class="sc">$</span>Year<span class="sc">&gt;</span><span class="dv">90</span>,]</span>
<span id="cb91-3"><a href="norway---default-settings.html#cb91-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-4"><a href="norway---default-settings.html#cb91-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> temp[temp<span class="sc">$</span>Year<span class="sc">&gt;</span><span class="dv">90</span>,],</span>
<span id="cb91-5"><a href="norway---default-settings.html#cb91-5" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> Month, </span>
<span id="cb91-6"><a href="norway---default-settings.html#cb91-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> Biomass_FG_3<span class="sc">/</span><span class="dv">10</span><span class="sc">^</span><span class="dv">6</span>),</span>
<span id="cb91-7"><a href="norway---default-settings.html#cb91-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">group =</span> )<span class="sc">+</span></span>
<span id="cb91-8"><a href="norway---default-settings.html#cb91-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">lwd =</span> <span class="dv">1</span>, <span class="at">colour =</span> <span class="st">&quot;black&quot;</span>)<span class="sc">+</span></span>
<span id="cb91-9"><a href="norway---default-settings.html#cb91-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span> )<span class="sc">+</span></span>
<span id="cb91-10"><a href="norway---default-settings.html#cb91-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb91-11"><a href="norway---default-settings.html#cb91-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Biomass (tons) for herbivorous,</span><span class="sc">\n</span><span class="st">ectothermic and semelparous species&quot;</span>)</span></code></pre></div>
<p><img src="04-Norway_default_settings_files/figure-html/unnamed-chunk-31-1.png" width="672" /></p>
<p>Again, values are a lot lower! The insects here are showing erruptive or irruptive behavious as well.</p>
</div>
<div id="biomass-densities-rather-than-total-biomass" class="section level2" number="5.3">
<h2><span class="header-section-number">5.3</span> Biomass densities rather than total biomass</h2>
<p>The model predicts the total biomass for each grid cell. For reporting and for comparing with reference data, it is probably better to convert this to biomass densities. J Hoeks showed me a simple way to do this:</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="norway---default-settings.html#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load grid properties, the list_output_paths() can be used to see all outputs by the model</span></span>
<span id="cb92-2"><a href="norway---default-settings.html#cb92-2" aria-hidden="true" tabindex="-1"></a>gridProps <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">list_output_paths</span>(mdata2)<span class="sc">$</span>grid_properties[<span class="dv">1</span>])</span>
<span id="cb92-3"><a href="norway---default-settings.html#cb92-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-4"><a href="norway---default-settings.html#cb92-4" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate area of simulation, exclude marine grid cells</span></span>
<span id="cb92-5"><a href="norway---default-settings.html#cb92-5" aria-hidden="true" tabindex="-1"></a>AreaKm2 <span class="ot">&lt;-</span> <span class="fu">sum</span>(gridProps<span class="sc">$</span>GetCellArea[gridProps<span class="sc">$</span>IsMarine<span class="sc">==</span><span class="dv">0</span>])</span></code></pre></div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="step-4---spin-up-and-demonstrating-plotting-functions.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="exploring-spatial-inputs.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
